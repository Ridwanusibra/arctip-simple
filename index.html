<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arc Tip Jar</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.13.4/dist/ethers.umd.min.js"></script>

<style>
  /* ---------- GLOBAL ---------- */
  * { box-sizing:border-box; margin:0; padding:0; font-family:'Segoe UI',sans-serif; }
  body { min-height:100vh; background: linear-gradient(135deg,#020617,#0f172a); color:#e5e7eb; }
  a { text-decoration:none; color:inherit; }

  /* ---------- CONTAINER ---------- */
  .container { max-width:900px; margin:0 auto; padding:20px; }

  /* ---------- HERO ---------- */
  .hero { text-align:center; padding:60px 20px; background:linear-gradient(135deg,#0ea5e9,#38bdf8); border-radius:20px; margin-bottom:30px; color:#020617; box-shadow:0 20px 50px rgba(0,0,0,0.5);}
  .hero h1 { font-size:2.8em; margin-bottom:10px; }
  .hero p { font-size:1.2em; margin-bottom:20px; }
  .hero button { padding:14px 28px; font-weight:bold; border:none; border-radius:14px; cursor:pointer; transition:.3s; background:#020617; color:#38bdf8; }
  .hero button:hover { background:#0ea5e9; color:#020617; }

  /* ---------- CREATOR CARDS ---------- */
  .creator-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:30px; }
  .creator-card { background:rgba(15,23,42,0.95); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,0.4); text-align:center; transition:.3s; cursor:pointer; }
  .creator-card:hover { transform:translateY(-5px); box-shadow:0 15px 40px rgba(0,0,0,0.5); }
  .creator-card img { width:80px; height:80px; border-radius:50%; object-fit:cover; margin-bottom:10px; }
  .creator-card h4 { margin-bottom:6px; color:#38bdf8; }
  .creator-card p { font-size:13px; color:#cbd5f5; }

  /* ---------- TIP FORM ---------- */
  .tip-form { background:rgba(15,23,42,0.95); padding:20px; border-radius:16px; box-shadow:0 15px 40px rgba(0,0,0,0.5); max-width:420px; margin:0 auto; }
  .tip-form label { display:block; font-size:13px; margin-top:12px; color:#cbd5f5; }
  .tip-form input, .tip-form select { width:100%; padding:12px; margin-top:4px; border-radius:12px; border:none; background:#020617; color:#fff; }
  .tip-form button { width:100%; margin-top:14px; padding:14px; border-radius:14px; border:none; font-weight:bold; cursor:pointer; transition:.2s; }
  .primary { background:linear-gradient(135deg,#38bdf8,#0ea5e9); color:#020617; }
  .primary:hover { opacity:.9; }
  .secondary { background:transparent; border:1px solid #38bdf8; color:#38bdf8; }
  .secondary:hover { background:#38bdf8; color:#020617; }
  .status { text-align:center; font-size:13px; margin-top:10px; word-break:break-word; color:#fcd34d; }

  /* ---------- PROFILE DISPLAY ---------- */
  .profile-display { display:flex; align-items:center; margin-top:10px; gap:12px; }
  .profile-display img { width:60px; height:60px; border-radius:50%; object-fit:cover; }
  .profile-info { flex:1; font-size:13px; color:#cbd5f5; }

  @media(max-width:500px){
    .hero h1 { font-size:2em; }
    .hero p { font-size:1em; }
  }
</style>
</head>

<body>
<div class="container">
  <!-- HERO -->
  <div class="hero">
    <h1>Arc Tip Jar</h1>
    <p>Support your favorite creators with USDC</p>
    <button onclick="connect()">Connect MetaMask</button>
    <div class="status" id="walletStatus">Not connected</div>
  </div>

  <!-- CREATOR GRID -->
  <div class="creator-grid" id="creatorGrid"></div>

  <!-- TIP FORM -->
  <div class="tip-form">
    <h3>Send a Tip</h3>
    <label>Select Creator</label>
    <select id="creatorSelect" onchange="displaySelectedCreator()">
      <option value="">--Enter new creator below--</option>
    </select>

    <label>Or Enter Creator Address</label>
    <input id="creatorInput" placeholder="0x..." />

    <label>Amount (USDC)</label>
    <input id="amount" type="number" placeholder="5" />

    <label>Message</label>
    <input id="message" placeholder="Keep building ðŸš€" />

    <button class="primary" onclick="sendTip()">Send Tip</button>
    <div class="divider"></div>

    <h3>Your Creator Profile</h3>
    <label>Name</label>
    <input id="profileName" placeholder="Your name" />
    <label>Bio</label>
    <input id="profileBio" placeholder="Short bio" />
    <label>Profile Picture</label>
    <input type="file" id="profilePicFile" accept="image/*" />
    <button class="secondary" onclick="saveProfile()">Save Profile</button>
    <button class="secondary" onclick="registerCreator()">Register as Creator</button>

    <div class="status" id="status">Idle</div>

    <div class="profile-display" id="profileDisplay" style="display:none;">
      <img id="profileImage" src="" />
      <div class="profile-info">
        <div id="profileNameDisplay"></div>
        <div id="profileBioDisplay"></div>
      </div>
    </div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const CONTRACT_ADDRESS = "0xA4918c3f21E37dE845aC2eD5e1A32656B6c52a78";
const USDC_ADDRESS = "0x3600000000000000000000000000000000000000";

const ABI = [
  "function tip(address creator, uint256 amount, string message)",
  "function registerAsCreator()"
];

const ERC20_ABI = [
  "function approve(address spender, uint256 amount)",
  "function decimals() view returns (uint8)"
];

let provider, signer;
let creators = [];

/* ================= CONNECT ================= */
async function connect(){
  if(!window.ethereum && !window.web3) return alert("MetaMask not installed");
  provider = new ethers.BrowserProvider(window.ethereum);
  signer = await provider.getSigner();
  document.getElementById("walletStatus").innerText = "Connected: "+await signer.getAddress();
  loadProfile();
  loadCreatorsDropdown();
  renderCreatorGrid();
}

/* ================= PROFILE ================= */
function saveProfile(){
  const name=profileName.value;
  const bio=profileBio.value;
  const fileInput=document.getElementById("profilePicFile");

  if(fileInput.files && fileInput.files[0]){
    const reader=new FileReader();
    reader.onload=function(e){
      const pic=e.target.result;
      const profile={name,bio,pic};
      localStorage.setItem("profile",JSON.stringify(profile));
      addCreator(profile);
      loadProfile();
      renderCreatorGrid();
      document.getElementById("status").innerText="Profile saved ðŸ’¾";
    };
    reader.readAsDataURL(fileInput.files[0]);
  }else{
    const profile={name,bio,pic:""};
    localStorage.setItem("profile",JSON.stringify(profile));
    addCreator(profile);
    loadProfile();
    renderCreatorGrid();
    document.getElementById("status").innerText="Profile saved ðŸ’¾";
  }
}

function loadProfile(){
  const data=JSON.parse(localStorage.getItem("profile")||"{}");
  if(data.name||data.bio||data.pic){
    document.getElementById("profileDisplay").style.display="flex";
    document.getElementById("profileNameDisplay").innerText=data.name||"";
    document.getElementById("profileBioDisplay").innerText=data.bio||"";
    document.getElementById("profileImage").src=data.pic||"https://via.placeholder.com/60";
  }
}

/* ================= CREATOR DROPDOWN ================= */
function addCreator(profile){
  const addr=document.getElementById("creatorInput").value.trim();
  if(!addr) return;
  const exists=creators.find(c=>c.address===addr);
  if(!exists){
    creators.push({address:addr,name:profile.name,pic:profile.pic});
    localStorage.setItem("creators",JSON.stringify(creators));
    loadCreatorsDropdown();
  }
}

function loadCreatorsDropdown(){
  const select=document.getElementById("creatorSelect");
  select.innerHTML='<option value="">--Enter new creator below--</option>';
  const stored=JSON.parse(localStorage.getItem("creators")||"[]");
  creators=stored;
  creators.forEach(c=>{
    const opt=document.createElement("option");
    opt.value=c.address;
    opt.text=c.name;
    select.appendChild(opt);
  });
}

function displaySelectedCreator(){
  const sel=document.getElementById("creatorSelect");
  const addr=sel.value;
  const profile=creators.find(c=>c.address===addr);
  if(profile){
    document.getElementById("profileDisplay").style.display="flex";
    document.getElementById("profileNameDisplay").innerText=profile.name;
    document.getElementById("profileBioDisplay").innerText=profile.bio;
    document.getElementById("profileImage").src=profile.pic||"https://via.placeholder.com/60";
    document.getElementById("creatorInput").value=addr;
  }
}

/* ================= RENDER CREATOR GRID ================= */
function renderCreatorGrid(){
  const grid=document.getElementById("creatorGrid");
  grid.innerHTML="";
  creators.forEach(c=>{
    const div=document.createElement("div");
    div.className="creator-card";
    div.onclick=()=>{document.getElementById("creatorInput").value=c.address; displaySelectedCreator();}
    div.innerHTML=`<img src="${c.pic||'https://via.placeholder.com/80'}" />
                   <h4>${c.name}</h4>
                   <p>${c.bio}</p>`;
    grid.appendChild(div);
  });
}

/* ================= TIP ================= */
async function sendTip(){
  if(!signer) return alert("Connect wallet first");
  const creator=document.getElementById("creatorInput").value.trim();
  const amount=document.getElementById("amount").value;
  const message=document.getElementById("message").value;

  if(!ethers.isAddress(creator)) return alert("Invalid creator address");
  if(amount<=0) return alert("Enter a valid amount");

  const usdc=new ethers.Contract(USDC_ADDRESS,ERC20_ABI,signer);
  const tipJar=new ethers.Contract(CONTRACT_ADDRESS,ABI,signer);
  const decimals=await usdc.decimals();
  const value=ethers.parseUnits(amount,decimals);

  document.getElementById("status").innerText="Approving USDC...";
  await usdc.approve(CONTRACT_ADDRESS,value);

  document.getElementById("status").innerText="Sending tip...";
  const tx=await tipJar.tip(creator,value,message);
  await tx.wait();

  document.getElementById("status").innerText="Tip sent ðŸŽ‰";
}

/* ================= REGISTER CREATOR ================= */
async function registerCreator(){
  if(!signer) return alert("Connect wallet first");
  const tipJar=new ethers.Contract(CONTRACT_ADDRESS,ABI,signer);
  const tx=await tipJar.registerAsCreator();
  await tx.wait();
  document.getElementById("status").innerText="Registered as creator âœ…";
}
</script>
</body>
</html>